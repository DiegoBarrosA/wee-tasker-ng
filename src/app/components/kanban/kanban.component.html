<app-navbar></app-navbar>
<div class="h-screen p-2">
  <div
    class="grid lg:grid-cols-7 md:grid-cols-4 sm:grid-cols-2 gap-5 overflow-x-auto custom-scroll"
  >
    <div class="bg-white rounded px-2 py-2 overflow-hidden">
      <div class="flex flex-row justify-between items-center mb-2 mx-1">
        <div class="flex items-center">
          <h2 class="bg-red-100 text-sm w-max px-1 rounded mr-2 text-gray-700">
            To-do
          </h2>
          <p class="text-gray-400 text-sm"></p>
        </div>
        <div class="flex items-center text-gray-300">
          <p class="mr-2 text-2xl">
            {{ getTaskCountByStatus(statuses[0]) }}
          </p>
          <button
            (click)="this.show_dialog = true"
            class="text-2xl create-task-btn"
            type="button"
          >
            +
          </button>
        </div>
      </div>
      <div id="To_Do"></div>

      <div *ngFor="let task of tasks">
        <div *ngIf="task.status.id == 0" class="grid py-2 grid-rows-1 gap-2">
          <div class="p-2 rounded shadow-sm border-gray-100 border-2">
            <h2 class="text-sm mb-3 text-gray-700">{{ task.summary }}</h2>

            <select
              (change)="onStatusChange(task, $event)"
              [ngClass]="task.status.tailwind_class"
            >
              <option
                *ngFor="let status of statuses"
                [ngClass]="status.tailwind_class"
                [value]="status.id"
                [selected]="status.id === task.status.id"
              >
                {{ status.name }}
              </option>
            </select>
            <div class="flex flex-row items-center mt-2">
              <h4 class="text-sm mb-3 text-gray-400">{{ task.description }}</h4>
            </div>
          </div>
        </div>
      </div>

      <div
        class="flex flex-row items-center text-gray-300 mt-2 px-1"
        (click)="this.show_dialog = true"
      >
        <p class="rounded mr-2 text-2xl">+</p>
        <p class="pt-1 rounded text-sm">New</p>
      </div>
    </div>
    <div class="bg-white rounded px-2 py-2 overflow-hidden">
      <div class="flex flex-row justify-between items-center mb-2 mx-1">
        <div class="flex items-center">
          <h2
            class="bg-yellow-100 text-sm w-max px-1 rounded mr-2 text-gray-700"
          >
            WIP
          </h2>
          <p class="text-gray-400 text-sm">
            <!-- Task counter -->
          </p>
        </div>
        <div
          class="flex items-center text-gray-300"
          (click)="this.show_dialog = true"
        >
          <p class="mr-2 text-2xl">
            {{ getTaskCountByStatus(statuses[1]) }}
          </p>
          <p class="text-2xl">+</p>
        </div>
      </div>
      <div id="WIP"></div>
      <div *ngFor="let task of tasks">
        <div *ngIf="task.status.id == 1" class="grid py-2 grid-rows-1 gap-2">
          <div class="p-2 rounded shadow-sm border-gray-100 border-2">
            <h2 class="text-sm mb-3 text-gray-700">{{ task.summary }}</h2>

            <select
              (change)="onStatusChange(task, $event)"
              [ngClass]="task.status.tailwind_class"
            >
              <option
                *ngFor="let status of statuses"
                [ngClass]="status.tailwind_class"
                [value]="status.id"
                [selected]="status.id === task.status.id"
              >
                {{ status.name }}
              </option>
            </select>
            <div class="flex flex-row items-center mt-2">
              <h4 class="text-sm mb-3 text-gray-400">{{ task.description }}</h4>
            </div>
          </div>
        </div>
      </div>

      <div
        class="flex flex-row items-center text-gray-300 mt-2 px-1"
        (click)="this.show_dialog = true"
      >
        <p class="rounded mr-2 text-2xl">+</p>
        <p class="pt-1 rounded text-sm">New</p>
      </div>
    </div>
    <div class="bg-white rounded px-2 py-2 overflow-hidden">
      <div class="flex flex-row justify-between items-center mb-2 mx-1">
        <div class="flex items-center">
          <h2
            class="bg-green-100 text-sm w-max px-1 rounded mr-2 text-gray-700"
          >
            Complete
          </h2>
          <p class="text-gray-400 text-sm">
            <!-- Task counter -->
          </p>
        </div>
        <div class="flex items-center" (click)="this.show_dialog = true">
          <p class="text-gray-300 mr-2 text-2xl">
            {{ getTaskCountByStatus(statuses[2]) }}
          </p>
          <p class="text-gray-300 text-2xl">+</p>
        </div>
      </div>
      <div id="Complete"></div>

      <div *ngFor="let task of tasks">
        <div *ngIf="task.status.id == 2" class="grid py-2 grid-rows-1 gap-2">
          <div class="p-2 rounded shadow-sm border-gray-100 border-2">
            <h2 class="text-sm mb-3 text-gray-700">{{ task.summary }}</h2>

            <select
              (change)="onStatusChange(task, $event)"
              [ngClass]="task.status.tailwind_class"
            >
              <option
                *ngFor="let status of statuses"
                [ngClass]="status.tailwind_class"
                [value]="status.id"
                [selected]="status.id === task.status.id"
              >
                {{ status.name }}
              </option>
            </select>
            <div class="flex flex-row items-center mt-2">
              <h4 class="text-sm mb-3 text-gray-400">{{ task.description }}</h4>
            </div>
          </div>
        </div>
      </div>

      <div
        class="flex flex-row items-center text-gray-300 mt-2 px-1"
        (click)="this.show_dialog = true"
      >
        <p class="rounded mr-2 text-2xl">+</p>
        <p class="pt-1 rounded text-sm">New</p>
      </div>
    </div>

    <div *ngIf="show_dialog" class="relative z-10" id="new-task-modal">
      <div
        class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
      ></div>
      <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div
          class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"
        >
          <div
            class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"
          >
            <div class="px-5">
              <form
                [formGroup]="taskCreationForm"
                (ngSubmit)="submitTask(this.statuses)"
              >
                <div class="space-y-12">
                  <div class="border-b border-gray-900/10 pb-12">
                    <div
                      class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
                    >
                      <div class="col-span-full">
                        <div class="mt-2">
                          <input
                            type="text"
                            name="summary"
                            id="summary"
                            formControlName="summary"
                            autocomplete="summary"
                            class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none text-dark border-gray-600 focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer form-control"
                            placeholder="Summarize your idea."
                          />
                        </div>
                      </div>
                      <div class="col-span-full">
                        <div class="mt-2">
                          <textarea
                            id="description"
                            name="description"
                            formControlName="description"
                            rows="3"
                            class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none text-dark border-gray-600 focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer form-control"
                            placeholder=" What needs to be done?"
                          ></textarea>
                        </div>
                      </div>
                    </div>

                    <div
                      *ngIf="
                        (taskCreationForm.get('summary')?.invalid &&
                          (taskCreationForm.get('summary')?.dirty ||
                            taskCreationForm.get('summary')?.touched)) ||
                        (taskCreationForm.get('description')?.invalid &&
                          (taskCreationForm.get('description')?.dirty ||
                            taskCreationForm.get('description')?.touched))
                      "
                      class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative"
                      role="alert"
                    >
                      <div class="px-4">
                        <ul class="list-disc">
                          <h4><strong class="font-bold">Error: </strong></h4>
                          <span
                            *ngIf="
                              taskCreationForm.get('summary')?.invalid &&
                              (taskCreationForm.get('summary')?.dirty ||
                                taskCreationForm.get('summary')?.touched)
                            "
                            class="block sm:inline"
                          >
                            <li>The {{ getErrorMessage("summary") }}</li></span
                          >
                          <span
                            *ngIf="
                              taskCreationForm.get('description')?.invalid &&
                              (taskCreationForm.get('description')?.dirty ||
                                taskCreationForm.get('description')?.touched)
                            "
                            class="block sm:inline"
                          >
                            <li>
                              The {{ getErrorMessage("description") }}
                            </li></span
                          >
                        </ul>
                      </div>
                      <span class="absolute top-0 bottom-0 right-0 px-4 py-3">
                        <svg
                          class="fill-current h-6 w-6 text-red-500"
                          role="button"
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                        >
                          <title>Close</title>
                          <path
                            d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"
                          />
                        </svg>
                      </span>
                    </div>

                    <div class="mt-6 flex items-center justify-end gap-x-6">
                      <button
                        type="button"
                        class="text-sm/6 font-semibold text-gray-900 create-task-btn"
                        (click)="this.show_dialog = false"
                      >
                        Cancel
                      </button>
                      <button
                        type="submit"
                        class="rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
                      >
                        Save
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
